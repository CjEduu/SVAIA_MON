{% extends "layout.html"%}

{% block head %}
  {{ super() }}
  <script src="{{ url_for('static',filename='/js/index.js') }}"></script>
{% endblock %}
{% block content%}
     <div class="main-content" style="padding-bottom: 20px; background:linear-gradient(to bottom right, rgba(255, 255, 255, 0.5), rgba(36, 42, 61, 0.5));">
            <div><!--Directorio-->
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../4/index.html">Inicio</a></li>
                    <li class="breadcrumb-item active">Chat</li>
                  </ol>
            </div>

            <div class="row d-flex flex-column flex-lg-row justify-content-center mx-5 mx-lg-0 "> <!--Bloque central-->
                <div class="col-12 col-lg-4"><!--Bloque izq-->
                    <div class="card my-lg-0 my-2">
                        <div class="text-end">
                            <a href="{{ url_for('crear_proyecto', next=request.url) }}" class="icon-button mx-3">
                                <i class="bi bi-plus-square-fill text-success fs-2"></i>
                            </a>
                        </div>
                        <div class="card-body text-end d-none d-lg-block" style="padding: 0px 8px 8px 8px;">



                            <div class="list-group text-start">
                                {% for p in proyectos %}
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    {{ p.nombre }}
                                    <button type="button" class="btn btn-danger text-end p-1" onclick="eliminarProyecto('{{ p.nombre }}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="dropdown w-100 d-lg-none d-block">
                            <button class="btn w-100 bg-white text-start d-flex justify-content-between align-items-center border" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Proyectos
                                <i class="bi bi-chevron-down"></i>
                            </button>
                            <ul class="dropdown-menu w-100">
                                {% for p in proyectos %}
                                <li><a class="dropdown-item" href="#">{{ p.nombre }}</a></li>
                                {% endfor%}
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="col-lg-7 col-12"><!--Bloque dr-->
                    <div class="card">
                        <div class="card-body" ><!-- Contenedor para los mensajes -->
                            <div id="contenedor-mensajes" style="margin-bottom: 10px;">
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="input-group ">
                                <input id="formulario" type="text" class="form-control" placeholder="Escribe tu mensaje..." aria-label="Recipient's username" aria-describedby="button-addon2">
                                <button class="btn btn-primary" type="button" id="boton_enviar">Enviar</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>



<script>
    function eliminarProyecto(nombre) {
      if (!confirm(`¿Estás seguro de que quieres eliminar el proyecto "${nombre}"?`)) return;
    
      fetch(`http://127.0.0.1:4444/api/proyectos/eliminar/${encodeURIComponent(nombre)}`, {
        method: "DELETE"
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(errorData => {
            throw new Error(errorData.error || "Error al eliminar el proyecto");
          });
        }
        return response.json();
      })
    .then(data => {
      window.location.href = "{{ url_for('chat') }}";  // Redirige a la lista de proyectos
    })
      .catch(error => {
        alert("Error: " + error.message);
      });
    }
    </script>

{% endblock %}
