{% extends "layout.html" %}

{% block content %}
<div class="container mt-5" style="padding-top: 80px; padding-bottom: 120px;">
    <div class="mx-auto" style="max-width: 600px;">  <!-- Limita ancho y centra -->
        <h2 class="text-center mb-4">Nuevo Proyecto</h2>
        <!--<form method="POST">-->
        <form id="formCrearProyecto" onsubmit="crearProyecto(event)">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" name="nombre" class="form-control" required>
            </div>
             <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción</label>
                <textarea id="descripcion" name="descripcion"class="form-control" rows="4" placeholder="Opcional..."></textarea>
             </div>
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">Crear</button>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>

<script>
  function crearProyecto(event) {
    event.preventDefault();  // Evita el envío tradicional del formulario
    
    const formData = new FormData(event.target);  // Recoge todos los datos del formulario

    // Realizamos una solicitud POST al backend para crear el nuevo proyecto
    fetch("http://127.0.0.1:4444/api/proyectos/crear", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials:'include',
      body: JSON.stringify({
        nombre: formData.get("nombre"),
        descripcion: formData.get("descripcion")
      })
    })
    .then(response => {
      if (!response.ok) {
        return response.json().then(errorData => {
          throw new Error(errorData.error || "Error al crear el proyecto");
        });
      }
      return response.json();
    })
    .then(data => {
      // Obtener el valor de "next" desde la URL actual
      const params = new URLSearchParams(window.location.search);
      const next = params.get("next") || "{{ url_for('proyectos') }}";
      
      // Redirigir al destino adecuado
      window.location.href = next;
    })
    .catch(error => {
      alert("Error: " + error.message);  // Muestra errores si ocurren
    });
  }
</script>

{% endblock %}


